name: Init Heroku App

on:
    workflow_dispatch:
        inputs:
            environment:
                description: "Target environment (must match a GitHub Environment name)"
                required: true
                type: choice
                options: [staging, prod]
            region:
                description: "Heroku region"
                required: true
                default: eu
                type: choice
                options: [eu, us]
            app_name:
                description: "Override Heroku app name (optional)"
                required: false
            service:
                description: "Service name (optional, default repo name)"
                required: false
            non_secret_overrides:
                description: "JSON map of NON-secret env overrides (optional)"
                required: false
            team:
                description: "Heroku Team (organization) name"
                required: true
                default: gotravel

jobs:
    init:
        uses: KosyanMedia/devcom-infra-utils/.github/workflows/init-heroku-reusable.yml@master
        with:
            environment: ${{ inputs.environment }}
            region: ${{ inputs.region }}
            app_name: ${{ inputs.app_name }}
            service: ${{ inputs.service }}
            non_secret_overrides: ${{ inputs.non_secret_overrides }}
            team: ${{ inputs.team }}
            branch: master
        secrets:
            HEROKU_API_TOKEN: ${{ secrets.HEROKU_API_TOKEN }}
            NODE_AUTH_TOKEN: ${{ secrets.NODE_AUTH_TOKEN }}
            NODE_ENV: ${{ secrets.NODE_ENV }}
